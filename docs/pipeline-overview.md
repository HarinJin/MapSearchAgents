# 에이전트 파이프라인 아키텍처

## 개요

자연어 쿼리를 받아 지도 검색을 수행하는 순차적 다중 에이전트 파이프라인입니다. 각 에이전트는 특정 인지 작업을 담당하며, 결과를 다음 단계로 전달합니다.

## 파이프라인 흐름

```
사용자 쿼리
    |
    v
[1] Translator -----> 은어/맥락 해석, provider 결정
    |                 (예: "노가리" → 호프/포차 키워드)
    v
[2] MapSearch ------> 검색 전략 수립 (반경/경로)
    |                 좌표, 반경, 키워드 조합 결정
    v
[3] APIPicker ------> API 실행 (카카오 또는 Google)
    |                 scripts/{kakao,google}-search.js
    v
[4] PlaceEnricher ---> 영업시간 보강 (시간 조건 시만)
    | (조건부)
    v
[5] Google Details --> 리뷰 데이터 수집 (Google 검색 시)
    |
    v
[6] Insight Agent ---> 리뷰 분석, 카테고리 생성, 번역
    |                  Phase 1A: 카테고리 + placeIds 매핑
    |                  Phase 1B: 팁 + 주의사항 생성
    |                  Phase 2: 증거 추출 + 번역
    v
[7] HTML 생성 ------> generate-page.js → 포터블 HTML
                       (Leaflet 지도, 3패널, API 키 제거)
```

## 에이전트 역할

| 에이전트 | 역할 | 입력 | 출력 |
|---------|------|------|------|
| **Translator** | 은어/맥락 해석 | 원본 쿼리 | 표준화된 키워드, provider, confidence |
| **MapSearch** | 검색 전략 | 쿼리+맥락 | 좌표, 반경/경로, 키워드 조합 |
| **APIPicker** | API 실행 | 검색 계획 | 장소 목록 JSON |
| **PlaceEnricher** | 영업시간 조회 | 장소 목록 | 영업시간, 현재 영업 상태 |
| **Insight Agent** | 데이터 분석/생성 | 리뷰 데이터 | 카테고리, 팁, 증거 (한국어) |

## 핵심 설계 결정

1. **레퍼런스 기반 해석**: 은어 사전(references/slang-*.md) 기반으로 할루시네이션 방지
2. **Provider 분기**: 카카오 기본(국내), Google은 시간/해외만 사용 (비용 절약)
3. **JSON 템플릿 기반**: 자동 HTML 생성으로 일관성 유지
4. **단일 책임**: 각 에이전트가 1가지 인지 작업만 담당

## 지원하는 검색 유형

- **simple**: "강남역 근처 카페"
- **contextual**: "노가리 까기 좋은 곳" (은어 포함)
- **route**: "강남에서 판교 가는 길에" (경로 기반)
- **complex**: 경로 + 맥락 복합

## 시나리오 (교차 가능)

일상, 여행, 육아/가족, 시간 기반, 반려동물, 운동/액티비티
